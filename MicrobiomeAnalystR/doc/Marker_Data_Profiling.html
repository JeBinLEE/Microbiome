<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Marker_Data_Profiling</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Marker_Data_Profiling</h1>



<div id="introduction-to-the-marker-gene-data-profiling-module" class="section level2">
<h2>1.0 Introduction to the Marker Gene Data Profiling Module</h2>
<p>Typically, the first question of microbiome data analysis is to determine if there are any patterns within the data. Such exploratory analyses are conducted via commonly used ecological techniques including alpha and beta diversity. Multivariate statistics such as PERMANOVA and ANOSIM can be employed to assess the robustness of such patterns in the microbial community composition. Once global differences are identified, the next logical step is to identify which taxa are responsible for this difference. Identification of important taxa is assessed with univariate statistics. Univariate statistics include classical and model-based approaches, which vary on their assumptions of microbiome data structure but ultimately compare taxa abundance between groups. While it is important to know which taxa are associated with phenotypic differences between samples, users may also wish to know if there are also potential functional differences between groups. MicrobiomeAnalyst implements two popular methods for predictive functional profiling - PICRUSt (1) and Tax4Fun (2), resulting in gene abundance tables that can be inputted in the SDP module.</p>
<div id="visual-exploration" class="section level3">
<h3>1.1 Visual Exploration</h3>
<p><strong>Stacked bar/area plot</strong></p>
<p>MicrobiomeAnalystR supports the creation of stacked bar (PlotTaxaAlphaBar) or area plots (PlotTaxaAlphaArea). Further color customization is available using the viridis R package. These color palettes (e.g. “viridis”, “magma”, “plasma”, and “inferno”) are robust to color blindness.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="co"># Stacked bar plot, percentage abundance, genus level, viridis color palette</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotTaxaAundanceBar</span>(mbSet, <span class="st">&quot;taxa_alpha_1&quot;</span>,<span class="st">&quot;Genus&quot;</span>,<span class="st">&quot;Group&quot;</span>, <span class="st">&quot;none&quot;</span>, <span class="st">&quot;barraw&quot;</span>,<span class="dv">10</span>, <span class="st">&quot;set3&quot;</span>,<span class="st">&quot;sum&quot;</span>,<span class="dv">10</span>, <span class="st">&quot;bottom&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;png&quot;</span>);</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="co"># Stacked area plot, class level, viridis color palette</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotTaxaAbundanceArea</span>(mbSet, <span class="st">&quot;taxa_alpha_3&quot;</span>,<span class="st">&quot;overview&quot;</span>,<span class="st">&quot;Genus&quot;</span>,<span class="st">&quot;Group&quot;</span>, <span class="dv">10</span>, <span class="st">&quot;viridis&quot;</span>,<span class="st">&quot;sum&quot;</span>,<span class="dv">10</span>,<span class="st">&quot;bottom&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;png&quot;</span>);</span></code></pre></div>
<p><strong>Pie Charts</strong></p>
<p>MicrobiomeAnalystR provides several functions to create pie charts from microbiome data. First, the <em>PlotOverallPieGraph</em> function plots a pie-chart of all samples at the user-specified taxonomic level. Second, the <em>PlotGroupPieGraph</em> plots a group-wise pie-chart of all samples within the user-specified group at the user-specified taxonomic level. Finally, the <em>PlotSamplePieGraph</em> function creates a pie-chart for a specific sample. To save all pie charts, first use the <em>GetSeriesColors</em> function followed by the <em>SavePiechartImg</em> function.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="co"># Overall pie chart</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotOverallPieGraph</span>(mbSet, <span class="st">&quot;Phylum&quot;</span>, <span class="dv">10</span>,<span class="st">&quot;sum&quot;</span>, <span class="dv">10</span>, <span class="st">&quot;bottom&quot;</span>);</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="kw">GetSeriesColors</span>()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>mbSet&lt;-<span class="kw">SavePiechartImg</span>(mbSet, <span class="st">&quot;Phylum&quot;</span>,<span class="st">&quot;primary_piechart_0&quot;</span>,<span class="st">&quot;png&quot;</span>);</span></code></pre></div>
<p><strong>Heat Tree</strong></p>
<p>The heat tree analysis (<em>PrepareHeatTreePlot</em>) uses the hierarchical structure of taxonomic classifications to quantitatively (using the median abundance) and statistically (using the non-parametric Wilcoxon Rank Sum test) depict taxonomic differences between microbial communities. It generates a differential heat tree using the metacoder R package that shows which taxa are more/less abundant in each group. The statistical comparison can be obtained from the “tax_diff_dm.csv” file outputted in your working directory. Please refer to the paper by Foster et al. for more details (PMID 28222096). The <em>PrepareHeatTreePlot</em> also incorporates the viridis R package for additional color palettes.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="co"># Heat tree at the genus level comparing pediatric CD vs healthy controls. Only</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="co"># significant taxon (p &lt; 0.05) are labelled. </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PrepareHeatTreePlot</span>(mbSet, <span class="dt">meta=</span><span class="st">&quot;Class&quot;</span>, <span class="dt">taxalvl=</span><span class="st">&quot;Genus&quot;</span>, <span class="dt">color=</span><span class="st">&quot;plasma&quot;</span>, <span class="dt">layoutOpt=</span><span class="st">&quot;reda&quot;</span>, <span class="dt">comparison=</span><span class="st">&quot;CD_vs_Control&quot;</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>                          <span class="dt">wilcox.cutoff =</span> <span class="fl">0.05</span>, <span class="dt">imgName=</span><span class="st">&quot;heat_tree_0&quot;</span>, <span class="dt">format=</span><span class="st">&quot;png&quot;</span>, <span class="dt">dpi=</span><span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="community-profiling" class="section level3">
<h3>1.2 Community Profiling</h3>
<p>Alpha-diversity is a measure of within sample diversity, while beta-diversity is a measure of between/among samples diversity. Alpha-diversity measures can be considered summary statistics of the diversity of single samples, while beta-diversity estimates can be considered similarity scores between pairs of samples. For the latter, these measures permit further analyses via clustering or dimension reduction techniques. Various statistical tests can be applied to the sample clusters to evaluate significant differences. More details are available below.</p>
<div id="alpha-diversity" class="section level4">
<h4>1.21 Alpha Diversity</h4>
<p>Alpha-diversity summarizes both the species richness (feature variety) and/or evenness (feature distribution) within a sample (59, 60). Six alpha-diversity measures are currently supported in MicrobiomeAnalyst, each assessing different aspects of the community. Observed calculates the total number of features per sample, while ACE and Chao1 estimates taxa richness by accounting for undetected features due to low abundance. Meanwhile, Shannon and Simpson take species richness and evenness into account, with varying weight given to evenness. Finally, Fisher models the community abundance structure as a logarithmic series distribution.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="co"># Create a dot plot of alpha diversity measures. Samples are grouped by the &quot;Class&quot; experimental factor and colored</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="co"># using the viridis color palette.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotAlphaData</span>(mbSet, <span class="st">&quot;filt&quot;</span>,<span class="st">&quot;alpha_diver_0&quot;</span>,<span class="st">&quot;Chao1&quot;</span>,<span class="st">&quot;Class&quot;</span>,<span class="st">&quot;OTU&quot;</span>, <span class="st">&quot;default&quot;</span>, <span class="st">&quot;png&quot;</span>);</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="co"># Create summary box plot of alpha diversity measures using the viridis color palette.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotAlphaBoxData</span>(mbSet, <span class="st">&quot;alpha_diverbox_0&quot;</span>,<span class="st">&quot;Chao1&quot;</span>,<span class="st">&quot;Class&quot;</span>,<span class="st">&quot;default&quot;</span>, <span class="st">&quot;png&quot;</span>);</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a><span class="co"># Calculate alpha-diversity significance using the parametric t-test (two groups).</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PerformAlphaDiversityComp</span>(mbSet, <span class="st">&quot;tt&quot;</span>,<span class="st">&quot;Class&quot;</span>);</span></code></pre></div>
</div>
<div id="beta-diversity" class="section level4">
<h4>1.22 Beta Diversity</h4>
<p>Beta-diversity evaluates differences in the community composition between samples (i.e. distance). Resulting beta-diversity estimates can be combined into a distance matrix and used for ordination to visualize how the microbial diversity of samples between groups have changed. MicrobiomeAnalyst supports the five most commonly used beta-diversity measures. Bray-Curtis dissimilarity uses abundance data and calculates differences in feature abundance. Jensen-Shannon divergence assess the distance between two probability distributions that account for the presence and abundance of microbial features. Jaccard distance instead uses just the presence or absence of features to calculate differences in microbial composition. Unweighted and weighted UniFrac uses the phylogenetic distance between features. The former is based purely on phylogenetic distance, while the latter is weighted by the relative abundance of features.</p>
<p>Beta-diversity measures can be visualized using either principal coordinates analysis (PCoA) or nonmetric multidimensional scaling (NMDS). Both methods take the distance matrix as input, where PCoA maximizes the linear correlation between samples and NMDS maximizes the rank order correlation between samples (61). Note that NMDS is iterative and may return different results for the same dataset. Furthermore, MicrobiomeAnalyst calculates a stress value for the NMDS plot, which is a measure of goodness-of-fit. Generally, values greater than 0.2 suggest a poor fit while values less than 0.1 are good. Users should use PCoA if distances between samples are so close that a linear transformation would suffice. Also, NMDS is suggested if users wish to highlight the gradient structure within their data (61, 62).</p>
<p>Ordination measures between the groups are assessed for statistical significance using either permutational MANOVA (PERMANOVA), Analysis of group similarities (ANOSIM) (63), or Homogeneity of group dispersions (PERMDISP). Generally, these tests evaluate global differences in microbiome composition between groups. PERMANOVA tests if the centroids of all groups are equivalent, or rather that the sample clusters are in the same location. It uses the distances (or dissimilarity) between samples of the same group and compares it to the distances between groups (64, 65). This method is sensitive to multivariate dispersions, therefore PERMDISP should also be used to evaluate if the dispersion (or variation) between samples differs from the dispersion between groups (64, 65). Meanwhile, ANOSIM tests whether within-group distances are greater or equal to between-group distances, using the ranks of all pair-wise sample distances. In other words, it evaluates whether samples within a group are as clustered as samples belonging to different groups.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="co"># Create a PCoA score plot using the viridis custom color palette, data points are colored</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="co"># by their group label.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotBetaDiversity</span>(mbSet, <span class="dt">plotNm=</span><span class="st">&quot;beta_diver_0&quot;</span>, <span class="dt">ordmeth=</span><span class="st">&quot;PCoA&quot;</span>, <span class="dt">distName=</span><span class="st">&quot;bray&quot;</span>, <span class="dt">colopt=</span><span class="st">&quot;expfac&quot;</span>, <span class="dt">metadata=</span><span class="st">&quot;Class&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>                         <span class="dt">showlabel=</span><span class="st">&quot;none&quot;</span>, <span class="dt">taxrank=</span><span class="st">&quot;OTU&quot;</span>, <span class="dt">taxa=</span><span class="st">&quot;null&quot;</span>, <span class="dt">alphaopt=</span><span class="st">&quot;Chao1&quot;</span>, <span class="dt">ellopt=</span><span class="st">&quot;yes&quot;</span>, <span class="dt">format=</span><span class="st">&quot;png&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>                         <span class="dt">dpi=</span><span class="dv">72</span>, <span class="dt">custom_col=</span><span class="st">&quot;viridis&quot;</span>);</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a><span class="co"># Creates a json file for 3D PCoA, use the web to view the interactive 3D PCoA plot</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>    mbSet&lt;-<span class="kw">PCoA3D.Anal</span>(mbSet, <span class="st">&quot;PCoA&quot;</span>,<span class="st">&quot;bray&quot;</span>,<span class="st">&quot;OTU&quot;</span>,<span class="st">&quot;expfac&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;Chao1&quot;</span>,<span class="st">&quot;beta_diver3d_0.json&quot;</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a><span class="co"># Calculate the beta-diversity significance</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PerformCategoryComp</span>(mbSet, <span class="st">&quot;OTU&quot;</span>, <span class="st">&quot;adonis&quot;</span>,<span class="st">&quot;bray&quot;</span>,<span class="st">&quot;Group&quot;</span>);</span></code></pre></div>
</div>
<div id="core-microbiome" class="section level4">
<h4>1.23 Core Microbiome</h4>
<p>The core microbiome refers to the set of taxa that are detected in a high fraction of the population above a given abundance threshold. The count data is transformed to compositional (relative) abundances in order to perform such analysis. Use the <em>CoreMicrobeAnalysis</em> to calculate and plot the core microbiome analysis. The function also outputs a “core_microbiome.csv” file in your working directory.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="co"># Create a core microbiome plot using the viridis color palette</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>mbSet&lt;-<span class="kw">CoreMicrobeAnalysis</span>(mbSet, <span class="st">&quot;core_micro_0&quot;</span>,<span class="fl">0.2</span>,<span class="fl">0.01</span>,<span class="st">&quot;OTU&quot;</span>,<span class="st">&quot;bwm&quot;</span>,<span class="st">&quot;overview&quot;</span>, <span class="st">&quot;all_samples&quot;</span>, <span class="st">&quot;Group&quot;</span>, <span class="st">&quot;CD&quot;</span>, <span class="st">&quot;png&quot;</span>);</span></code></pre></div>
</div>
</div>
<div id="clustering-analysis" class="section level3">
<h3>1.3 Clustering Analysis</h3>
<div id="heatmap-clustering" class="section level4">
<h4>1.31 Heatmap Clustering</h4>
<p>Use the <em>PlotHeatmap</em> to create a heatmap of microbiome data at a preferred taxonomic level. The function supports various clustering algorithms and distance measures for performing hierarchical clustering.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="co"># Create a heatmap at the OTU level using the plasma color palette</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotHeatmap</span>(mbSet, <span class="st">&quot;heatmap_0&quot;</span>,<span class="st">&quot;euclidean&quot;</span>,<span class="st">&quot;ward.D&quot;</span>,<span class="st">&quot;bwm&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;OTU&quot;</span>,<span class="st">&quot;overview&quot;</span>,<span class="st">&quot;F&quot;</span>, <span class="st">&quot;png&quot;</span>,<span class="st">&quot;T&quot;</span>,<span class="st">&quot;F&quot;</span>);</span></code></pre></div>
</div>
<div id="dendogram-analysis" class="section level4">
<h4>1.32 Dendogram Analysis</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="co"># Create a dendogram of the microbiome data at the OTU level.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotTreeGraph</span>(mbSet, <span class="st">&quot;plot_tree_0&quot;</span>,<span class="st">&quot;bray&quot;</span>,<span class="st">&quot;ward.D&quot;</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;OTU&quot;</span>, <span class="st">&quot;default&quot;</span>, <span class="st">&quot;png&quot;</span>);</span></code></pre></div>
</div>
<div id="correlation-analysis" class="section level4">
<h4>1.33 Correlation Analysis</h4>
</div>
<div id="pattern-search" class="section level4">
<h4>1.34 Pattern Search</h4>
<p>MicrobiomeAnalystR supports the identification of patterns in user’s data. Users can define the pattern using a specific taxa, a predefined profile, or a custom profile. First, use the <em>FeatureCorrelation</em> function to identify the patterns. This will output the “correlation_feature.csv” file in your working directory. Next, use the <em>PlotCorr</em> function to plot the results.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="co"># Identify and plot the pattern </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>mbSet&lt;-<span class="kw">Match.Pattern</span>(mbSet, <span class="st">&quot;pearson&quot;</span>, <span class="st">&quot;1-2&quot;</span>, <span class="st">&quot;Genus&quot;</span>, <span class="st">&quot;Group&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotCorr</span>(mbSet, <span class="st">&quot;ptn_1&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dt">width=</span><span class="ot">NA</span>)</span></code></pre></div>
</div>
</div>
<div id="univariate-analysis" class="section level3">
<h3>1.4 Univariate Analysis</h3>
<p>MicrobiomeAnalystR supports both classical and model-based methods for differential abundance analysis. All methods test if each taxon is associated with a dichotomous outcome (e.g. case vs. control). As many methods are available, the choice of differential abundance analysis depends on the quality and stricture of a user’s data. Further, it is advisable for users to compare the results from multiple methods and visualize the features with boxplots to increase one’s confidence.</p>
</div>
<div id="classical-univariate-analysis" class="section level3">
<h3>1.41 Classical Univariate Analysis</h3>
<p>Both parametric (T-test/ANOVA) and non-parametric (Mann-Whitney/Kruskall-Wallis) algorithms are available, their use dependent on whether microbiome features are normally distributed. The null hypothesis of the T-test and ANOVA is that the means of two or more populations are equal, whereas for Mann-Whitney and Kruskall-Wallis, the null hypothesis is that the mean ranks of the groups are the same (63). As microbiome data is typically skewed from the norm, Mann-Whitney is recommended and widely used (7). However, classical methods do not account for the compositionality of the data which can result in spurious correlations (7).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="co"># Classical non-parametric univariate analysis: Mann-Whitney/Kruskall Wallis</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PerformUnivarTest</span>(mbSet, <span class="st">&quot;Group&quot;</span>,<span class="fl">0.05</span>,<span class="st">&quot;NA&quot;</span>,<span class="st">&quot;OTU&quot;</span>,<span class="st">&quot;nonpar&quot;</span>);</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a><span class="co"># Classical parametric univariate analysis: T-test/ANOVA</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PerformUnivarTest</span>(mbSet, <span class="st">&quot;Group&quot;</span>,<span class="fl">0.05</span>,<span class="st">&quot;NA&quot;</span>,<span class="st">&quot;OTU&quot;</span>,<span class="st">&quot;tt&quot;</span>);</span></code></pre></div>
</div>
<div id="model-based-univariate-analysis" class="section level3">
<h3>1.42 Model-based Univariate Analysis</h3>
<p>For RNA-seq data, differential analysis is applied to identify differentially expressed genes, paralleling the aim of identifying differentially abundant taxa from microbiome data. RNA-seq based methods, including DESeq2 (19) and edgeR (50), have since been readily applied to the microbiome (42). Both methods are parametric, based on generalized linear models (GLMs), and assume read counts follow a Negative Binomial distribution (7). Where they differ is in the way they normalize the data. DESeq2 uses size factors to account for varying library sizes and shrinkage to correct for high dispersion (7). Meanwhile, edgeR can use different normalization methods, the most common being TMM (trimmed mean of M-values). Compared to transcriptomics data however, microbiome data are sparse and RNA-seq methods may not be appropriate as these models cannot account for excess zeros at lower taxonomic resolutions (i.e. OTU level) (64). To overcome such issues, a Zero-inflated Gaussian (ZIG) mixture model, implemented in the metagenomeSeq R package, was proposed (65). Several comparisons of model-based methods have demonstrated that metagenomeSeq tends to have a higher false positive rate as compared to DESeq2 and edgeR (42, 66). However, a large-scale benchmarking study recommended its use as it showed greater retrieval power (67). Moreover, another study found that DESeq2 showed higher sensitivity for small datasets (&lt;20 samples/group) and is more conservative than edgeR, however it has a high FDR with large or uneven library sizes (7). Finally, another benchmarking of differential abundance algorithms on metagenomics data deemed DESeq2 and edgeR were most suitable (66).</p>
<div id="rnaseq-methods" class="section level4">
<h4>1.43 RNAseq Methods</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="co"># edgeR at the OTU level</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PerformRNAseqDE</span>(mbSet, <span class="st">&quot;EdgeR&quot;</span>,<span class="fl">0.05</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;NA&quot;</span>,<span class="st">&quot;OTU&quot;</span>);</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a><span class="co"># deseq2 at OTU level</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PerformRNAseqDE</span>(mbSet, <span class="st">&quot;EdgeR&quot;</span>,<span class="fl">0.05</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;NA&quot;</span>,<span class="st">&quot;OTU&quot;</span>);</span></code></pre></div>
</div>
<div id="metagenomeseq" class="section level4">
<h4>1.44 metagenomeSeq</h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="co"># metegenomeSeq using the zero-inflated Gaussian fit model</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PerformMetagenomeSeqAnal</span>(mbSet, <span class="st">&quot;Group&quot;</span>,<span class="fl">0.05</span>,<span class="st">&quot;NA&quot;</span>,<span class="st">&quot;OTU&quot;</span>,<span class="st">&quot;zigfit&quot;</span>);</span></code></pre></div>
</div>
</div>
<div id="biomarker-analysis" class="section level3">
<h3>1.5 Biomarker Analysis</h3>
<p>Two commonly used methods to select important features are available in MicrobiomeAnalyst. LEfSe is a biomarker discovery method that was first developed for metagenomics data while Random Forest is an ensemble machine-learning method. More details are available below.</p>
<div id="lefse" class="section level4">
<h4>1.51 LEfSe</h4>
<p>Linear discriminant analysis effect size (LEfSe) is a non-parametric statistical method to identify microbial taxa that are significantly different between groups. LEfSe first utilizes the Kruskal-Wallis test to identify taxon abundances that are significantly different between groups. Linear discriminant analysis (LDA) is then applied to taxa that meet the significance threshold (i.e. P &lt; 0.05) to estimate their effect size (70, 71). This approach considers all taxonomic levels simultaneously and outputs a ranked list of taxa (by LDA score) in order of taxa most likely to explain group differences. A significance level of P &lt; 0.05 and LDA score of 2 is often used to determine taxa that best characterize each phenotype.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="co"># First perform LefSe analysis</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PerformLefseAnal</span>(mbSet, <span class="fl">0.1</span>, <span class="st">&quot;fdr&quot;</span>, <span class="fl">2.0</span>, <span class="st">&quot;Group&quot;</span>,<span class="st">&quot;F&quot;</span>,<span class="st">&quot;NA&quot;</span>,<span class="st">&quot;OTU&quot;</span>);</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a><span class="co"># Plot LefSe results</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotLEfSeSummary</span>(mbSet, <span class="dv">15</span>, <span class="st">&quot;dot&quot;</span>, <span class="st">&quot;bar_graph_0&quot;</span>,<span class="st">&quot;png&quot;</span>);</span></code></pre></div>
</div>
<div id="random-forest" class="section level4">
<h4>1.52 Random Forest</h4>
<p>Random Forest (RF) is a supervised machine-learning algorithm that has been applied to microbiome data to identify microbial taxa that differentiate between phenotypes (72, 73). RF is well-suited for large and noisy data such as from the microbiome as it is able to identify non-linear relationships, deal with variable interactions, and is hard to overfit (74). RF works by constructing multiple decisions trees using a randomly selected subset (i.e. bootstrapped) of the training data. In the end, all trees are merged (i.e. ensemble method) via a majority vote for a more accurate prediction. To evaluate classification accuracy, the “out-of-bag (OOB) error rate” is also calculated. During decision tree construction, 1/3 of samples are omitted from the training samples and are subsequently classified using the models. The OOB error rate is assessed by cross-validating results between the predictions and true groups. Additionally, RF calculates variable importance of all features for classification which is useful for users to identify biomarkers, or variables relevant to groups. Variable importance is calculated as the mean decrease in accuracy when a variable is excluded (74)</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="co"># First perform RF analysis</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>mbSet&lt;-<span class="kw">RF.Anal</span>(mbSet, <span class="dv">500</span>,<span class="dv">7</span>,<span class="dv">1</span>,<span class="st">&quot;Group&quot;</span>,<span class="st">&quot;OTU&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a><span class="co"># Plot the RF classification results</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotRF.Classify</span>(mbSet, <span class="dv">15</span>, <span class="st">&quot;rf_cls_0&quot;</span>,<span class="st">&quot;png&quot;</span>, <span class="dt">width=</span><span class="ot">NA</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a><span class="co"># Plot the RF Variable Importance Plot</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a>mbSet&lt;-<span class="kw">PlotRF.VIP</span>(mbSet, <span class="dv">15</span>, <span class="st">&quot;rf_imp_0&quot;</span>,<span class="st">&quot;png&quot;</span>, <span class="dt">width=</span><span class="ot">NA</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
